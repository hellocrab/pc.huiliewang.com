<style>


</style>

<link href="__PUBLIC__/style/css/dialog.css" rel="stylesheet">

<form class="form-horizontal" id="status_form6" action="{:U('business/offer')}" method="post">
    <input type="hidden" name="id" value="{:I('id')}">
    <input type="hidden" name="key" value="{:I('key')}">
<div class="full-height">
    <div class="content">
       <table class="beizhu">
           <tr  height="50">
               <td style="text-align: right;">姓名:</td>
               <td class="result_select" style="padding-left: 20px;">
                   <span href="javascript:void(0)" class="addgw">{$project['name']}</span>
               </td>
           </tr>
           <tr  height="50">
               <td style="text-align: right;">职位:</td>
               <td class="result_select" style="padding-left: 20px;">
                   <span href="javascript:void(0)" class="addgw">{$project['business_name']}</span>
               </td>
           </tr>
           <tr  height="150">
               <td style="text-align: right;">薪资结构:</td>
               <td class="result_select" style="padding-left: 20px;">
                   <textarea col="3" row="5" class="ccbeizhu" name="structure" placeholder="薪资结构（最多不超过200字）" maxlength="1000" style="margin-top: 10px;height: 120px;">{$list['structure']}</textarea>
               </td>
           </tr>
           <tr height="50">
               <td style="text-align: right;">转正后薪资:</td>
               <td style="padding-left: 20px;">
                   <input type="text" class="form-control timerinput" name="monthSalary" id="monthSalary" value="{$list['monthSalary']}" placeholder="请填写转正后月薪(元)" maxlength="200" style="width: 170px;float: left">
                   <i class="icon-remove" style="float: left;margin: 7px;color: #ccc;"></i>
                   <input type="text" class="form-control timerinput" name="month" value="{$list['month']}" id="month" placeholder="月数" style="width:70px;float: left" maxlength="2">
               </td>
           </tr>
           <tr height="50">
               <td style="text-align: right;"><label style="color: red;">*</label>年薪:</td>
               <td style="padding-left: 20px;">
                    <input type="number" class="form-control " name="YearSalary" value="{$list['YearSalary']}" placeholder="数值在0~500之间,且保留两位小数" id="YearSalary"  maxlength="6">
               </td>
               <td style="text-align: left;">
                   <label>万</label>
               </td>
           </tr>
           <tr  height="50">
               <td style="text-align: right;"><label style="color: red;">*</label>Offer签订日期:</td>
               <td style="padding-left: 20px;">
                   <div>
                       <input type="hidden" class="xxtime" value="" name="xxtime">
                       <input type="text" readonly="readonly" class="form-control timerinput"  name="offertime"  onFocus="WdatePicker({dateFmt:'yyyy-MM-dd  HH:mm', minDate:&quot;#F{$dp.$D('timestart')}&quot;,maxDate:'2038-01-01'})"  placeholder="请选择时间" value="{$list['offertime']}" >
                   </div>
               </td>
           </tr>
           <tr  height="50">
               <td style="text-align: right;"><label style="color: red;">*</label>预计收入:</td>
               <td style="padding-left: 20px;">
                   <div>
                       <input type="text" class="form-control " name="income"  placeholder="元" maxlength="500"  value="{$list['income']}">
                   </div>
               </td>
           </tr>
           <tr  height="50">
               <td style="text-align: right;"><label style="color: red;">*</label>预计入职时间:</td>
               <td style="padding-left: 20px;">
                   <div>
                       <input type="hidden" class="xxtime" value="" name="xxtime">
                       <input type="text" readonly="readonly" class="form-control timerinput"  id="timeenter" name="entertime"  onFocus="WdatePicker({dateFmt:'yyyy-MM-dd  HH:mm', minDate:&quot;#F{$dp.$D('timestart')}&quot;,maxDate:'2038-01-01'})"  placeholder="请选择时间" value="{$list['entertime']}" >
                   </div>
               </td>
           </tr>
           <tr  height="50">
               <td style="text-align: right;">预计离职时间:</td>
               <td style="padding-left: 20px;">
                   <div>
                       <input type="hidden" class="xxtime" value="" name="xxtime">
                       <input type="text" readonly="readonly" class="form-control timerinput"  id="timestart" name="leavetime"  onFocus="WdatePicker({dateFmt:'yyyy-MM-dd  HH:mm', minDate:&quot;#F{$dp.$D('timestart')}&quot;,maxDate:'2038-01-01'})"  placeholder="请选择时间" value="{$list['leavetime']}" >
                   </div>
               </td>
           </tr>
           <tr>
               <td style="text-align: right;">备注:</td>
               <td style="padding-left: 20px;">
                   <textarea col="3" row="5" name="remarks" class="ccbeizhu" placeholder="请填写备注（最多不超过1000字）" maxlength="1000" style="margin-top: 10px;"> {$list['remarks']}</textarea>
               </td>
           </tr>
           <tr>
               <td style="text-align: right;"><label style="color: red;">*</label>上传offer附件:</td>
               <td style="padding-left: 20px;">
                   <div>
                       <input type="button" class="btn btn-primary addfile" name="submit_file" value="+上传offer附件"><br>
                       <div class="file_list"></div>
                       <div id="filecontent" <if condition="$temp eq ''">class="hide"</if>>
                           <span class="tishiinfo"><img src="/Public/img/addFile.png"><span class="fujian">附件</span></span>
                           <span id="addfilediv">{$temp}本次共添加了<span id="file_num">{$file_num}</span>文件,总大小<span id="file_size">{$file_size}</span>KB&nbsp;<a href="javascript:;" style="color: #5a8ee2;" onclick="delall();">全部删除</a></span>
                       </div>
                   </div>
               </td>
           </tr>

       </table>
    </div>
</div>
</form>

<div style="display:none" id="dialog-gw">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>




<script>



    $(function () {
        $("#monthSalary").blur(function(){
            var month = $("#month").val();
            var monthSalary = $(this).val();
            if(month){
                var yearSalary = month*monthSalary;

                $("#YearSalary").val(yearSalary);
            }
        })

        $("#month").blur(function(){
            var monthSalary = $("#monthSalary").val();
            var month = $(this).val();
            if(monthSalary){
                var yearSalary = month*monthSalary;
                $("#YearSalary").val(yearSalary);
            }
        })

        $("input").on("blur",function () {
            $(this).css("border","1px solid #d8e3ef");
        })

        $(".addfile").click(function(){
            $('#dialog-file').dialog('open');
            $('#dialog-file').load('{:U("file/addlogfile")}');
        });

        $("#dialog-file").dialog({
            autoOpen: false,
            modal: true,
            width: 800,
            maxHeight: 400,
            position: ["center",100],
            buttons: {
                "确定": function () {
                    $.ajax({
                        cache: true,
                        type: "POST",
                        url:'{:U("file/getfiles")}',
                        data:$('#uploadForm').serialize(),
                        async: false,
                        success: function(data) {
                            var result = data.data.file_list;
                            $('#filecontent').removeAttr('class');
                            var temp = '';
                            if(result){
                                $.each(result,function(k,v){
                                    temp += '<div class="showfile" id="del_'+v.file_id+'"><input type="hidden" name="file[]" value="'+v.file_id+'"/><img src="__PUBLIC__/productImg/'+v.pic+'">&nbsp;<span style="color:#646464;">'+v.name+'&nbsp;(&nbsp;'+v.size+'KB&nbsp;)</span>&nbsp;&nbsp;<a href="javascript:;" rel="'+v.file_id+'" onclick="del_file(this);"><img src="__PUBLIC__/img/delfile.png"/></a></div>';
                                });
                                $('#addfilediv').before(temp);
                                var old_file_num = Number($('#file_num').html());
                                var old_file_size = Number($('#file_size').html());
                                var new_file_num = old_file_num+data.data.file_num;
                                var new_file_size = old_file_size+data.data.file_size;
                                $('#file_num').html(new_file_num);
                                $('#file_size').html(new_file_size);
                            }

                        }
                    });
                    $(this).dialog("close");
                },
                "取消": function () {
                    $(this).dialog("close");
                }
            }
        });

    })

    //全部删除 函数
    function delall(){
        swal({
                title: "您确定要删除附件信息吗？",
                text: "删除后将无法恢复，请谨慎操作！",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "删除",
                cancelButtonText: "取消",
                closeOnConfirm: false
            },
            function(isConfirm){
                if (isConfirm) {
                    $('.showfile').each(function(){
                        var id = $(this).find('input[type="hidden"]').val();
                        del_obj(id);
                    });
                }else{
                    return false;
                }
            });
    }

    //删除 函数
    function del_obj(id){
        var module = 'contract';
        $.post("{:U('file/filedel')}",{file_id:id,module:module},function(data){
                if(data.status == 1){
                    $('#del_'+id).remove();
                    swal("删除成功！", "你的文件被删除了", "success");
                    if($('.showfile').length > 0){
                        return true;
                    }else{
                        $('#filecontent').addClass('hide');
                    }
                }else{
                    swal({
                        title: "提示",
                        text: data.info,
                        type: "error"
                    });
                }
            },"json"
        );
    }
    //删除
    function del_file(obj){
        var id = $(obj).attr('rel');
        swal({
                title: "您确定要删除附件信息吗？",
                text: "删除后将无法恢复，请谨慎操作！",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "删除",
                cancelButtonText: "取消",
                closeOnConfirm: false
            },
            function(isConfirm){
                if (isConfirm) {
                    del_obj(id);
                }else{
                    return false;
                }
            });
    }
</script>
