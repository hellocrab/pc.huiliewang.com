<include file="Public:header" />
<script type="text/javascript" src="__PUBLIC__/style/js/TableFreeze.js"></script>
<style type="text/css">
	body {
		overflow-y: hidden;
	}

	.active {
		font-weight: 600;
		color: #000;
	}

	.nav.nav-tabs-left li {
		width: 100%;
	}

	.nav-tabs-left>li.active>a {
		border-top: white;
		color: #19aa8d !important;
		background-color: #fff;
	}

	.ibox-span {
		float: left;
		margin-left: 30px;
		line-height: 30px;
	}


	.table_ tbody tr,.resi_dialog tr {
		cursor: auto !important;
	}

	.table_ {
		width: 100%;
		background: #f9f9f9;
	}

	 tbody {
		display: block;
		overflow-y: scroll;
		max-height: 720px;
		padding-bottom: 40px;
	}

	 thead {
		width: calc(100% - 16px) !important;
	}

	 thead,
	tbody tr {
		display: table;
		width: 100%;
		table-layout: fixed;
	}

	.table_ tr:nth-child(2n) {
		background: #fff;
	}

	 td,
	 th {
		padding: 10px 0px;
		white-space: wrap;
		border-bottom: 1px solid #edeff0;
		text-align: center;
		position: relative;
	}

	.pager_ {
		background: #f9f9f9;
		margin: 0;
		height: 50px;
		display: flex;
		align-items: center;
		justify-content: flex-end;
		position: absolute;
		width: 100%;
		bottom: 0;
	}

	.pageBox span {
		border-right: 1px solid #e6e6e6;
		line-height: 30px;
		width: 30px;
		display: inline-block;
		text-align: center;
		cursor: pointer;
	}

	.pageBox span:nth-last-child(1) {
		border-right: none;
	}

	.pageBox {
		border: 1px solid #e6e6e6;
		border-radius: 6px;
		margin-left: 10px;
		margin-right: 10px;
		display: flex;
	}

	.pageBox .choosed {
		background: #ccc;
	}

	#goto {
		height: 30px;
		padding-left: 10px;
		border: #e6e6e6;
		border-radius: 4px;
	}

	.onctr {
		cursor: pointer;
	}

	.onctr:hover {
		color: #6cf;
	}

	.dialog {
		width: 100vw;
		height: 100vh;
		background: rgba(0, 0, 0, .2);
		position: fixed;
		top: 0;
		left: 0;
		display: none;
		z-index: 999;
	}

	.resi_dialog .dialogBox {
		width: 591px;
		background: #fff;
		margin: 40px auto 0;
	}

	.dialogHead {
		text-align: right;
		padding: 15px;
	}

	.dialogHead img {
		cursor: pointer;
	}

	.dialogTitle {
		display: flex;
		align-items: center;
		padding-left: 50px;
		height: 17px;
		color: #333;
	}

	.dialogTitle div {
		width: 4px;
		height: 17px;
		background: rgba(56, 108, 189, 1);
		margin-right: 10px;
	}

	.dialogfoot {
		text-align: center;
	}

	.dialogfoot button {
		width: 76px;
		height: 27px;
		border-radius: 6px;
		text-align: center;
		line-height: 27px;
		outline: none;
		border: none;
		color: #fff;
	}

	.submit {
		background: rgba(88, 138, 216, 1);
	}

	.cannal {
		background: rgba(220, 74, 74, 1);
		margin-right: 47px;
	}
	.resi_dialog .dialogfoot{
    padding: 20px 0;
}
	.resi_dialog .dialogfoot button{
		width: auto;
		padding-left: 10px;
		padding-right: 10px;
	}
	.tas{
		width: 100%;
		padding: 0 38px;
		height: 660px;
		background: url('Public/img/isd_03.png') no-repeat center center transparent;
	}
	.resi_dialog table{
		background: rgba(185, 209, 240, .4);
		border-radius: 6px;
		margin: 10px 0;
	}
	.diata1 tbody{
		height: 30px;
		overflow-y: hidden;
	}
	.diata2 tbody{
		height: 430px;
	}
	.diata2 td{
		padding-left: 5px;
		padding-right: 5px;
	}
	.resi_dialog th{
		color: #386CBD;
	}
	.resi_dialog p span{
		color: #386CBD;
	}
</style>
<script>
	$(function () {
		let currentPage = 1;
		let totalPage_ = 1;
		$.ajax({
			url: '/index.php?m=user&a=departmentList',
			success(res) {
				if (res.code == 200) {
					res.info.map(val => {
						$('#department').append(
							`<option value='${val.department_id}'>${val.name}</option>`)
					})
				}
			}
		})
		getData();

		function getData() {
			$.ajax({
				url: '/index.php?m=user&a=transferList',
				type: 'post',
				data: {
					page: currentPage,
					page_size: $('#pageSize').val(),
					department_id: $('#department').val(),
					search: $('#short_search').val()
				},
				success(res) {
					if (res.code == 200 && res.info.list) {
						let doc = '';
						res.info.list.map((val, index) => {
							doc += `<tr>
                        <td>${val.user_name}</td>
                        <td>${val.parent_department}</td>
                        <td>${val.department}</td>
                        <td>${val.city}</td>
                        <td>${val.phone}</td>
                        <td>${val.receiver}</td>
                        <td>${val.add_time}</td>
                        <td><span class='ctr ${val.status==2?'':'onctr'}' index='${val.id}' status='${val.status}'>${val.status==1?'已处理':val.status==2?'已拒绝':'待处理'}</span></td>
                    </tr>`
						})
						$('.table_ tbody').empty();
						$('.table_ tbody').append(doc);
						let totalPage = Math.ceil(res.info.counts / $('#pageSize').val());
						totalPage_ = totalPage;
						let page = '<span class="last">«</span>';
						if (totalPage >= 3) {
							if (res.info.current_page != 1 && res.info.current_page != totalPage) {
								for (let i = 0; i < 3; i++) {
									page +=
										`<span class="page${i==1?' choosed':''}">${res.info.current_page-1+i}</span>`
								}
							} else if (res.info.current_page == 1) {
								for (let i = 0; i < 3; i++) {
									page +=
										`<span class="page${i==0?' choosed':''}">${res.info.current_page-0+i}</span>`
								}
							} else if (res.info.current_page == totalPage) {
								for (let i = 0; i < 3; i++) {
									page +=
										`<span class="page${i==2?' choosed':''}">${res.info.current_page-2+i}</span>`
								}
							}
						} else if (totalPage < 3) {
							for (let i = 0; i < totalPage; i++) {
								page +=
									`<span class="page${i+1==res.info.current_page?' choosed':''}">${i+1}</span>`
							}
						}
						page += '<span class="next">»</span>';
						$('.pageBox').empty();
						$('.pageBox').append(page);
						$('.totalPage').html(
							`共${res.info.counts}条&nbsp;第${res.info.current_page}/${totalPage}页`)
						current_page = res.info.current_page;
						$('.page').click(ev => {
							current_page = $(ev.target).html().trim() - 0;
							getData();
						})
						$('.last').click(ev => {
							if (current_page == 1) return;
							current_page--;
							getData();
						})
						$('.next').click(ev => {
							if (current_page == totalPage) return;
							current_page++;
							getData();
						})
						$('.onctr').click(ev=>{
							$('.resi_dialog').css('display','block');
							if(ev.target.attributes[2].nodeValue==0){
								$('.resi_dialog .dialogfoot').css('display','block')
							}else{
								$('.resi_dialog .dialogfoot').css('display','none')
							}
							$.ajax({
								url:'/index.php?m=user&a=transferDetail',
								data:{transfer_id:ev.target.attributes[1].nodeValue},
								success(resp){
									if(resp.code == 200){
										$('.resi_dialog p span').html(`【${resp.info.user_name}】`);
										$('.resi_dialog p span').attr('role_id',resp.info.id)
										$('.resi_dialog .diata1 tbody').html(`<tr><td>${resp.info.customer_count}</td><td>${resp.info.resume_count}</td><td>${resp.info.project_count}</td></tr>`)
										let doc = '';
										resp.info.project_list.map(val=>{
											doc+=`<tr>
												<td>${val.name}</td>
												<td>${val.pro_type}</td>
												<td>${val.customer_name}</td>
												<td>${val.status}</td>
												<td>${val.create_time}</td>
												</tr>`
										})
										$('.resi_dialog .diata2 tbody').html(doc)
									}
								}
							})
						})
					} else {
						$('tbody').empty();
						$('.pageBox').empty();
						$('.pageBox').append(`<span class="last">«</span>
									<span class="page1 choosed">1</span>
									<span class="next">»</span>`)
						$('.totalPage').html(
							`共0条&nbsp;第1/0页`)
					}
				}
			})
		}
		$('#short_search').on('keydown', ev => {
			if (ev.keyCode == 13) {
			event.preventDefault();
				current_page = 1;
				getData();
			}
		})
		$('#short_search_btn').on('click', ev => {
			event.preventDefault();
				current_page = 1;
				getData();
		})
		$('#department').change(ev => {
			current_page = 1;
			getData();
		})
		$('.resi_dialog img').click(ev=>{
			$('.resi_dialog').css('display','none')
		})
		$('.resi_dialog .cannal').click(ev=>{
			$.ajax({
				url:'/index.php?m=user&a=receiveTransfer',
				data:{
					transfer_id:$('.resi_dialog p span').attr('role_id'),
					status:2
				},
				success(res){
					if(res.code==200){
						$('.resi_dialog').css('display','none')
						swal('操作成功','您已拒绝移交申请','success')
						getData();
					}else{
						swal('请求失败',res.info,'error')
					}
				}

			})
		})
		$('.resi_dialog .submit').click(ev=>{
			$.ajax({
				url:'/index.php?m=user&a=receiveTransfer',
				data:{
					transfer_id:$('.resi_dialog p span').attr('role_id'),
					status:1
				},
				success(res){
					if(res.code==200){
						$('.resi_dialog').css('display','none')
						swal('操作成功','您已接受移交申请','success')
						getData();
					}else{
						swal('请求失败',res.info,'error')
					}
				}

			})
		})
		var scroll_width = 5;
		$("#table_div").height(window.innerHeight - $("#table_div").offset().top - $("#tfoot_div").height() -
			parseInt($("#table_container").css("padding-bottom").replace("px", "")) - 60);
		$(window).resize(function () {
			$("#table_div").height(window.innerHeight - $("#table_div").offset().top - $("#tfoot_div")
				.height() - parseInt($("#table_container").css("padding-bottom").replace("px",
					"")) -
				60);
			$("#oDivL_tab_Test3").height($("#table_div").height() - scroll_width - 1).width($(
				"#oTableLH_tab_Test3").width());
			$("#oDivH_tab_Test3").height($("#oTableLH_tab_Test3").height()).width($("#table_div")
				.width() -
				scroll_width);
		})
		if ("{$Think.get.by}") {
			$("#filter_ul").prev().html($("#filter_ul>li>a.active").text() +
				'<span class="fa fa-angle-down small_fa"></span>');
		}
		$("#tab_Test3").FrozenTable(1, 0, 0);
		$("#oDivL_tab_Test3").height($("#table_div").height() - scroll_width).width($("#oTableLH_tab_Test3")
			.width());
		$("#oDivH_tab_Test3").height($("#oTableLH_tab_Test3").height()).width($("#table_div").width() -
			scroll_width);
	})
</script>
<div class="wrapper wrapper-content">
	<include file="Public:alert" />
	<div class="resi_dialog dialog">
		<div class="dialogBox">
			<div class="dialogHead">
				<img src="__PUBLIC__/img/customerManage/5_03.png" alt="">
			</div>
			<div class="dialogTitle">
				<div></div>
				离职移交确认
			</div>
			<div class="divide1"></div>
			<div class="tas">
				<p>员工<span>【XX】</span>提交离职申请，现将该员工的客户、人才、项目，移交给你，请你 确认以下信息，及时跟进项目情况 </p>
				<table class="diata1">
					<thead>
						<th>客户数</th>
						<th>人才数</th>
						<th>正在进行的项目</th>
					</thead>
					<tbody>

					</tbody>
				</table>
				<span>正在进行的项目</span>
				<table class="diata2">
						<thead>
								<th>项目名称</th>
								<th>项目类型</th>
								<th>客户</th>
								<th>进度</th>
								<th>创建时间</th>
							</thead>
							<tbody>

							</tbody>
				</table>
				<span>更多详情请点击项目查看</span>
			</div>
			<div class="dialogfoot">
				<button class="cannal">拒绝移交</button>
				<button class="submit">接受移交</button>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-12">
			<include file="Setting:setting_left" />
			<div class="col-md-10">
				<div id="table_container" style="border-top:3px solid #e7eaec;">
					<div class="title-bar">

						<div class="row " id="title-show">
							<form class="form-inline" id="">
								<ul class="breadcrum pull-right" style="margin-bottom: 0px">
									<li>
										<span style="margin-left:20px;">部门：</span>
										<select class="form-control" id="department"
											style="margin-bottom:5px;">
											<option value="">--全部--</option>
										</select>
									</li>
									<li>
										搜索：
										<div class="input-group">
											<input id="short_search" type="text" style="width:160px;"
												placeholder="请输入员工名称"
												class="form-control input-sm"/>
											<span class="input-group-btn">
												<button class="btn btn-default btn-search" id="short_search_btn" type="button"><i class="fa fa-search"></i></button>
											</span>
										</div>
									</li>

								</ul>
							</form>
						</div>
					</div>
					<div class="col-sm-12 ibox-content" style="margin-top:0px;padding:0px;">
						<div id="table_div" class="full-height-scroll" style="left:0px;top:0px;">
							<div>
								<table class="table_">
									<thead>
										<th>姓名</th>
										<th>事业部</th>
										<th>部门</th>
										<th>所在城市</th>
										<th>电话</th>
										<th>移交人员</th>
										<th>离职时间</th>
										<th>处理状态</th>
									</thead>
									<tbody></tbody>
								</table>
							</div>
							<div class="pager_">
								<select name="" id="pageSize" style="background:none;padding-right:10px;">
									<option value="20">20</option>
									<option value="30">30</option>
									<option value="40">40</option>
									<option value="50">50</option>
									<option value="60">60</option>
									<option value="70">70</option>
									<option value="80">80</option>
									<option value="90">90</option>
									<option value="100">100</option>
								</select>
								<span class="totalPage">
									共0条&nbsp;第1/0页
								</span>
								<div class="pageBox">
									<span class="last">«</span>
									<span class="page1 choosed">1</span>
									<span class="next">»</span>
								</div>
								<input type="number" id="goto">&nbsp;&nbsp;页&nbsp;&nbsp;&nbsp;&nbsp;
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- 模态框 -->
<div class="modal inmodal fade" id="Modal" tabindex="1" style="overflow:auto; border:1px solid #000000;" role="dialog">
	<div class="modal-dialog modal-md" style="width:700px;">
		<div class="modal-content" id="dep_modal">
		</div>
	</div>
</div>
<script type="text/javascript">
	/*模态框关闭或打开 先清除内容*/
	$(".modal").on("hide.bs.modal", function () {
		$(this).removeData("bs.modal");
	});
	$(".modal").on("show.bs.modal", function () {
		$(this).removeData("bs.modal");
	});

	$(function () {

	});
</script>
<include file="Public:footer" />