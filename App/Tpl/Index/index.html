<include file="Public:header" />
<link type="text/css" href="__PUBLIC__/css/dynamic.css" rel="stylesheet" />
<link type="text/css" href="__PUBLIC__/css/flat/blue.css" rel="stylesheet">
<style>
    /**
     * 首页仪表盘
     **/
    .wall .span6,
    .wall .span4 {
        margin-bottom: 20px;
    }

    .dash-border {
        border-collapse: separate;
        border-left: 0;
        height: 300px;
        /**border:1px solid lightgray;*/
        font-family: Microsoft Yahei;
        overflow: hidden;
    }

    .dash-border a {
        text-decoration: none;
    }

    .dash-border .content-chart {
        padding: 10px;
        width: auto;
        height: 79%;
        text-align: center;
        line-height: 15;
    }

    .dash-border .dash-title {
        font-size: 15px;
        color: #000;
        height: 41px;
        line-height: 2.5;
        padding-left: 10px;
        background: #F8F9FA;
    }

    .dash-border .dash-swtich {
        float: right;
        padding-right: 10px;
        font-size: 12px;
        line-height: 3.8;
        color: #999;
    }

    .dash-border .cut-line {
        width: 97%;
        margin: 0 auto;
        border-bottom: 1px solid lightgray;
    }

    .content-item {
        font-size: 13px;
        line-height: 2.8;
    }

    .content-item .content-main {
        float: left;
        width: 95%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-left: 15px;
        color: #666;
        margin-top: 5px;

    }

    .content-item .content-time {
        float: right;
        padding-right: 20px;
        color: #888;
    }

    .error_msg {
        font-size: 13px;
        color: #808080;
    }

    .notepad {
        width: 94.7%;
        height: 79%;
        margin: 5px;
        resize: none;
    }

    .sort-item {
        margin-top: 10px;
        border: 1px solid #ddd;
        background-color: #fff;
    }

    .allmap {
        width: 100%;
        height: 150px;
        display: none;
    }

    .top-panel>ul>li a.active {
        font-weight: 400;
    }

    .list0>li a {
        color: #93A6B5;
    }

    .list0>li a:active {
        color: #337ab7;
    }

    .col-span {
        float: left;
        position: relative;
        min-height: 1px;
        width: 20%;
        margin-left: 0px;
        text-align: center;
    }

    /*日志评论*/
    .talkcontent {
        clear: both;
        padding: 10px;
    }

    .talkcontent .talknow {
        padding: 10px;
    }

    .imgtx {
        width: 28px;
        float: left;
    }

    .neirong {
        margin-left: 42px;
        word-wrap: break-word;
        border-bottom: 1px solid #eee;
    }

    .reply_talk {
        margin: 12px 0 12px 0;
    }

    .reply_content {
        border: 1px solid #aaa;
        min-height: 80px;
        padding: 10px;
        border-radius: 2px;
        margin-left: 43px;
    }

    .reply_content:empty::before {
        color: #cab0ba;
        content: attr(placeholder);
    }

    .btn_reply {
        margin-top: 0px;
        float: right;
    }

    .content_lanage {
        border: 1px solid #eee;
        min-height: 51px;
        padding: 10px;
        border-radius: 2px;
    }

    .content_lanage:empty::before {
        color: #cab0ba;
        content: attr(placeholder);
    }

    .talkcontent {
        padding: 0px;
    }

    .talkcontent .talknow {
        padding: 10px 0px;
    }

    .tsinfo {
        padding: 6px;
        line-height: 30px;
    }

    #table_div {
        margin-bottom: 15px;
    }

    /*任务相关*/
    .dropdown,
    .dropup {
        position: relative;
    }

    .dropdown-menu.bullet {
        margin-top: 12px;
    }

    .dropdown-menu {
        padding: 1px 0;
        margin-top: 3px;
        border-radius: 0;
        -webkit-box-shadow: 0 3px 12px rgba(0, 0, 0, .05);
        box-shadow: 0 3px 12px rgba(0, 0, 0, .05);
        -webkit-transition: .25s;
        -o-transition: .25s;
        transition: .25s;
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1200;
        display: none;
        float: left;
        min-width: 160px;
        padding: 5px 0;
        margin: 2px 0 0;
        font-size: 14px;
        text-align: left;
        list-style: none;
        background-color: #fff;
        -webkit-background-clip: padding-box;
        background-clip: padding-box;
        border: 1px solid #ccc;
        border: 1px solid #e4eaec;
        border-radius: 3px;
        -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
    }

    .dropdown-menu>li {
        padding: 0 3px;
        margin: 2px 0;
    }

    .taskboard-stage-header .dropdown-menu>li>a {
        padding: 6px 10px;
        -webkit-transition: background-color .25s;
        -o-transition: background-color .25s;
        transition: background-color .25s;
        display: block;
        padding: 3px 20px;
        clear: both;
        font-weight: 400;
        line-height: 1.6;
        color: #76838f;
        white-space: nowrap;
    }

    .dropdown-menu li .icon:first-child,
    .dropdown-menu li>a .icon:first-child {
        width: 1em;
        margin-right: .5em;
        text-align: center;
    }

    #right-sidebar-task {
        width: 50% !important;
        right: -60%;
        background-color: #fff;
        overflow: hidden;
        position: fixed;
        top: 60px;
        z-index: 1009;
        bottom: 0;
        box-shadow: 0px 2px 1px #888888;
    }

    .agile-list li {
        margin-bottom: -1px;
        border: none;
    }

    .taskboard-stage {
        height: 90% !important;
    }

    .taskboard-stages {
        overflow-y: hidden !important;
    }

    .color-selector>li {
        position: relative;
        display: inline-block;
        width: 24px;
        height: 24px;
        margin: 0 5px 0 0;
        border-radius: 100%;
    }

    .bg-blue-600 label:before {
        background-color: #62a8ea !important;
    }

    .bg-green-600 label:before {
        background-color: #46be8a !important;
    }

    .bg-cyan-600 label:before {
        background-color: #57c7d4 !important;
    }

    .bg-orange-600 label:before {
        background-color: #f2a654 !important;
    }

    .bg-red-600 label:before {
        background-color: #f96868 !important;
    }

    .bg-blue-grey-600 label:before {
        background-color: #526069 !important;
    }

    .bg-purple-600 label:before {
        background-color: #926dde !important;
    }

    .bg-blue-600 label:after {
        background-color: #62a8ea !important;
    }

    .bg-green-600 label:after {
        background-color: #46be8a !important;
    }

    .bg-cyan-600 label:after {
        background-color: #57c7d4 !important;
    }

    .bg-orange-600 label:after {
        background-color: #f2a654 !important;
    }

    .bg-red-600 label:after {
        background-color: #f96868 !important;
    }

    .bg-blue-grey-600 label:after {
        background-color: #526069 !important;
    }

    .bg-purple-600 label:after {
        background-color: #926dde !important;
    }

    .radio label:before {
        width: 24px;
        height: 24px;
    }

    .radio label:after {
        left: 6px;
        top: 4px;
        font-family: "FontAwesome";
        content: "\f00c";
        color: #fff;
    }

    .img-circle {
        margin-right: 0px;
    }

    .list-group-item:hover {
        background-color: #fafafb !important;
    }

    .taskboard-list .list-group-item .task-members {
        float: left;
    }

    .action-wrap {
        float: left;
        width: 100%;
        height: 10%;
        min-height: 40px;
        background-color: #fff;
    }
</style>
<script type="text/javascript" src="__PUBLIC__/js/chart/highcharts.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/mychart/macarons.js"></script>
<script src="__PUBLIC__/js/mychart/echarts-plain.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.e-calendar.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/chart/funnel.js"></script>
<!-- echarts -->
<script type="text/javascript" src="__PUBLIC__/js/echarts/echarts.js"></script>
<!-- nice-scroll -->
<script src="__PUBLIC__/style/js/plugins/nice-scroll/jquery.nicescroll.min.js" type="text/javascript"></script>
<!--the css for jquery.mCustomScrollbar-->
<link rel="stylesheet" href="__PUBLIC__/emoji/css/jquery.mCustomScrollbar.min.css" />
<!--the css for this plugin-->
<link rel="stylesheet" href="__PUBLIC__/emoji/css/jquery.emoji.css" />
<script>
    let current_page = 1;
    let totalPage_ = 0;


    function onpick() {
        current_page = 1;
        getWorkMouments();

    }

    function getWorkMouments(type, keyWord) {
        //获取待办事项数据
        /*type: crm表示全部动态、
         *customer表示客户相关、
         *Business表示项目相关
         */
        $.ajax({
            url: '/index.php?m=message&a=messageList',
            data: {
                page: current_page,
                page_size: 20,
                type: '',
                deadline: $('#end_time').val()
            },
            type: 'get',
            success(res) {
                if (res.code == 200 && res.info) {
                    let doc = '';
                    if (res.info.list.length == 0) {
                        doc = '<tr><td colume="5">暂无数据</td></tr>'
                    } else {
                        res.info.list.map((val, index) => {
                            doc += `<tr>
                        <td>${val.content}</td>
                        <td>${val.deadline.substr(0,10)}</td>
                        <td>${val.degree}</td>
                        <td class='${val.status==0?'wait':val.status==1?'ed':'dead'}'>${val.status==0?'未处理':val.status==1?'已处理':'已过期'}</td>
                        <td style='display:${val.type!=2&&val.type!=3?'table-cell':'none'}'><a href='${val.link}' list_id='${val.message_id}'>${val.status==0?'去处理':'查看'}</a></td>
                        <td style='display:${val.type==3?'table-cell':'none'}'><a href='${val.link}' list_id='${val.message_id}'>${val.status==0?'去处理':''}</a></td>
                        <td style='display:${val.type==2?'table-cell':'none'}'><span class='check_birth' list_id='${val.message_id}'>查看</span></td>
                    </tr>`
                        })
                    }
                    $('.content table tbody').empty();
                    $('.content table tbody').append(doc);
                    $('.content table tbody').scrollTop(0);
                    $('.content table tbody a').click(ev => {
                        let id = ev.target.attributes[1].value;
                        $.ajax({
                            url: '/index.php?m=message&a=handle',
                            data: {
                                message_id: id,
                            },
                            success(res) {
                                $('.bri_dialog').css('display',
                                    'none');

                            }
                        })
                    })
                    $('.check_birth').click(ev => {
                        let id = ev.target.attributes[1].value
                        $.ajax({
                            url: '/index.php?m=message&a=birthdayList',
                            data: {
                                message_id: id

                            },
                            success(resp) {
                                if (resp.code == 200) {
                                    $('.today_bri').html(`今天生日共${resp.info.today.count}人`);
                                    let doc = '';
                                    if (resp.info.today.sons.length == 0) {
                                        doc = '<tr><td colume="5">暂无数据</td></tr>'
                                    } else {
                                        resp.info.today.sons.map(val => {
                                            doc += `<tr>
                                            <td>${val.customer_name}</td>
                                            <td>${val.rank}</td>
                                            <td>${val.achievement}</td>
                                            <td>${val.contacts}</td>
                                            <td>${val.telephone}</td>
                                            </tr>`
                                        })
                                    }
                                    $('.today_bri+.sd table tbody').html(doc);
                                    doc = '';
                                    $('.toweek_bri').html(`两周内生日共${resp.info.fifteen.count}人`)
                                    if (resp.info.fifteen.sons.length == 0) {
                                        doc = '<tr><td colume="6">暂无数据</td></tr>'
                                    } else {
                                        resp.info.fifteen.sons.map(val => {
                                            doc += `<tr>
                                            <td>${val.customer_name}</td>
                                            <td>${val.rank}</td>
                                            <td>${val.achievement}</td>
                                            <td>${val.contacts}</td>
                                            <td>${val.telephone}</td>
                                            <td>${val.birthday}</td>
                                            </tr>`
                                        })
                                    }
                                    $('.toweek_bri+.sd table tbody').html(doc);
                                    $('.bri_dialog').css('display', 'block');
                                    $('.dialogfoot .confirm').click(ev => {
                                        $.ajax({
                                            url: '/index.php?m=message&a=handle',
                                            data: {
                                                message_id: id,
                                            },
                                            success(res) {
                                                $('.bri_dialog').css('display',
                                                    'none');

                                            }
                                        })
                                    })
                                }
                            }
                        })
                    })
                    let totalPage = Math.ceil(res.info.counts / $('#pageSize').val());
                    totalPage_ = totalPage;
                    let page = '<span class="last">«</span>';
                    if (totalPage >= 3) {
                        if (res.info.current_page != 1 && res.info.current_page != totalPage) {
                            for (let i = 0; i < 3; i++) {
                                page +=
                                    `<span class="page${i==1?' choosed':''}">${res.info.current_page-1+i}</span>`
                            }
                        } else if (res.info.current_page == 1) {
                            for (let i = 0; i < 3; i++) {
                                page +=
                                    `<span class="page${i==0?' choosed':''}">${res.info.current_page-0+i}</span>`
                            }
                        } else if (res.info.current_page == totalPage) {
                            for (let i = 0; i < 3; i++) {
                                page +=
                                    `<span class="page${i==2?' choosed':''}">${res.info.current_page-2+i}</span>`
                            }
                        }
                    } else if (totalPage < 3) {
                        for (let i = 0; i < totalPage; i++) {
                            page +=
                                `<span class="page${i+1==res.info.current_page?' choosed':''}">${i+1}</span>`
                        }
                    }
                    page += '<span class="next">»</span>';
                    $('.pageBox').empty();
                    $('.pageBox').append(page);
                    $('.totalPage').html(
                        `共${res.info.counts}条&nbsp;第${res.info.current_page}/${totalPage}页`)
                    current_page = res.info.current_page;
                    $('.page').click(ev => {
                        current_page = $(ev.target).html().trim() - 0;
                        getWorkMouments();
                    })
                    $('.last').click(ev => {
                        if (current_page == 1) return;
                        current_page--;
                        getWorkMouments();
                    })
                    $('.next').click(ev => {
                        if (current_page == totalPage) return;
                        current_page++;
                        getWorkMouments();
                    })
                } else {
                    $('.content table tbody').empty();
                    $('.workMouments .content tbody').append(
                        '<tr><td class="noData" colspan="5">暂无更多数据</tr></td>'
                    )
                }
            }
        })
    }

    $(function () {
        var scroll_width = 5;
        getWorkMouments();
        getPipeline('');
        $(".nicescroll").niceScroll({
            cursorcolor: "#ccc", //#CC0071 光标颜色
            cursoropacitymax: 1, //改变不透明度非常光标处于活动状态（scrollabar“可见”状态），范围从1到0
            touchbehavior: false, //使光标拖动滚动像在台式电脑触摸设备
            cursorwidth: scroll_width + "px", //像素光标的宽度
            cursorborder: "0", //     游标边框css定义
            cursorborderradius: "5px", //以像素为光标边界半径
            autohidemode: false, //是否隐藏滚动条
            zindex: 100,
            background: "#F3F3F5", //滚动条背景色
        });
        $('.pipeline .dimens span').click(ev => {
            $('.pipeline .dimens span').removeClass('choosed');
            $(ev.target).addClass('choosed')
            let temp = $(ev.target).html();
            $('.pipeline table').empty()
            switch (temp.trim()) {
                case '进展中':
                    getPipeline('');
                    break
                case '签订offer':
                    getPipeline('offer');
                    break
                case '入职':
                    getPipeline('onjob');
                    break
            }
        })
        $('.dialog img').click(ev => {
            $('.dialog').css('display', 'none')

        })
        $('.searchInput input').on('keydown', ev => {
            if (ev.keyCode == 13) {
                $('.searchInput i').click();
            }
        })

        $('#goto').on('keydown', ev => {
            let reg = new RegExp(/^\d+$/);
            if (!($('#goto').val().trim().match(reg))) return;
            if (ev.keyCode == 13 && ($('#goto').val() - 0 <= totalPage_)) {
                current_page = $('#goto').val();
                getWorkMouments();
            }
        })
        $('#pageSize').change(ev => {
            current_page = 1;
            getWorkMouments()
        })

        function getPipeline(type) {
            $.ajax({
                url: 'index.php?m=index&a=pipeline',
                type: 'get',
                data: {
                    type
                },
                success(res) {
                    let temp = new String();
                    if (res.code == 200 && res.data) {
                        switch (type) {
                            case '':
                                $('.pipeline table').removeClass().addClass('ing');
                                temp = `<tr>
                                        <th>项目名称</th>
                                        <th>公司名称</th>
                                        <th>城市</th>
                                        <th>主要顾问</th>
                                        <th>项目状态</th>
                                        <th>更新时间</th>
                                    </tr>`
                                res.data.map(val => {
                                    let mangers = new String();
                                    val.owner.map(item => {
                                        mangers += `,${item.full_name}`
                                    })
                                    temp += `
                                <tr>
                                    <td>
                                        <a href='${val.business_href}'>${val.name}</a>
                                    </td>
                                    <td>
                                        <a href='${val.customer_href}'>${val.customer}</a>
                                    </td>
                                    <td>${val.address}</td>
                                    <td><p>${mangers.replace(',','')}</p></td>
                                    <td>${val.status}</td>
                                    <td>${val.updatetime}</td>
                                </tr>
                            `
                                })

                                break
                            default:
                                $('.pipeline table').removeClass().addClass('oth');
                                let temp_ = type == 'offer' ? '签订时间' : '入职时间'
                                temp = `<tr>
                                        <th>项目名称</th>
                                        <th>姓名</th>
                                        <th>公司</th>
                                        <th>职位</th>
                                        <th>电话</th>
                                        <th>邮箱</th>
                                        <th>生日</th>
                                        <th>用户</th>
                                        <th>${temp_}</th>
                                    </tr>`
                                res.data.map(val => {
                                    console.log(val.updatetime);
                                    val.updatetime = val.updatetime ? getTime(val.updatetime) :
                                        '';
                                    val.birthday = val.birthday ? getTime(val.birthday) : '';
                                    temp += `
                                <tr>
                                    <td>
                                        <a href='${val.business_href}'>${val.business_name}</a>
                                    </td>
                                    <td>
                                        <a href='${val.product_href}'>${val.name?val.name:''}</a>
                                    </td>
                                    <td>
                                        <a href='${val.customer_href}'>${val.customer_name}</a>
                                    </td>
                                    <td>${val.jobname}</td>
                                    <td>${val.telephone?val.telephone:''}</td>
                                    <td>${val.email?val.email:''}</td>
                                    <td>${val.birthday}</td>
                                    <td>${val.user?val.user:''}</td>
                                    <td>${val.updatetime}</td>
                                </tr>
                            `
                                })

                                break
                        }
                        $('.pipeCon table').append(temp)
                    } else {
                        temp = '<span class="noData">暂时没有数据</span>'
                        $('.pipeCon').append(temp)
                    }
                }
            })
        }

        function getTime(str) {
            let time = new Date(parseInt(str) * 1000);
            var year = time.getFullYear();
            var month = time.getMonth() + 1;
            var date = time.getDate();
            return year + "-" + month + "-" + date;
        }


        function getBlocks(range, part) {
            $.ajax({
                url: 'index.php?m=index&a=face_part',
                type: 'get',
                data: {
                    range,
                    part
                },
                success(res) {
                    if (res.code == 200) {
                        $('.showNum[part=' + part + ']').html(res.data)
                    }
                }
            })
        }
        $('#end_time').click(ev => {
            current_page = 1;
            getWorkMouments();
        })
        $('#pageSize').click(ev => {
            current_page = 1;
            getWorkMouments();
        })
        $('.range').click(ev => {
            let part = ev.target.dataset.part;
            $('.sec3[part=' + part + ']').css('height', '72px');
            $('.sec3 span').unbind();
            $('.sec3[part=' + part + '] span').click(e => {
                let con = $(e.target).html().trim();
                let aug = new String();
                switch (con) {
                    case '本周':
                        aug = 'currentweek';
                        break
                    case '本月':
                        aug = 'currentmonth';
                        break
                    case '上周':
                        aug = 'lastweek';
                        break
                    case '上月':
                        aug = 'lastmonth';
                        break
                }
                if (part == 'paid' || part == 'bill' || part == 'workerNum') return;
                getBlocks(aug, part);
                $('.sec3[part=' + part + ']').css('height', '0');
                $('span[data-part=' + part + ']').html(con)
            })
        })
        $('.sec3').on('mouseleave', ev => {
            $(ev.currentTarget).css('height', '0')
        })
    })
</script>
<link rel="stylesheet" href="__PUBLIC__/css/index.css">
<div class="page-wrapper wrapper wrapper-content animated fadeIn" style="background:#fff">
    <div class="bri_dialog dialog">
        <div class="dialogBox">
            <div class="dialogHead">
                <img src="__PUBLIC__/img/customerManage/5_03.png" alt="">
            </div>
            <div class="dialogTitle">
                <div></div>
                客户生日通知
            </div>
            <div class="divide1"></div>
            <span class='today_bri'>今日生日共2人</span>
            <div class="sd">
                <table>
                    <thead>
                        <th>公司名</th>
                        <th>级别</th>
                        <th>与我签约金额</th>
                        <th>联系人</th>
                        <th>联系电话</th>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <span class='toweek_bri'>今日生日共2人</span>
            <div class="sd">
                <table>
                    <thead>
                        <th>公司名</th>
                        <th>级别</th>
                        <th>与我签约金额</th>
                        <th>联系人</th>
                        <th>联系电话</th>
                        <th>生日日期</th>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="dialogfoot">
                <button class="confirm">我知道了</button>
            </div>
        </div>
    </div>
    <div class="blocks">
        <div>
            <img src="__PUBLIC__/img/paid.png" alt="图片加载失败">
            <div class="sec1">
                <span>已到款</span>
                <span class='range' data-part='integral'>本周</span>
            </div>
            <span class="showNum" part='integral'>{$datasum['integral']}</span>
            <div class='sec2'>
                <!-- <span>本年</span>
                <i class='fa fa-caret-down'></i> -->
            </div>
            <div class='sec3' part='integral'>
                <span>本周</span>
                <span>本月</span>
                <span>上周</span>
                <span>上月</span>
            </div>
        </div>
        <!-- <div>
            <img src="__PUBLIC__/img/staffNum.png" alt="">
            <div class="sec1">
                <span>应收款</span>
                <span class='range' data-part='bill'>本周</span>
            </div>
            <span class="showNum" part='bill'>0</span>
            <div class='sec2'>
                <span>本年</span>
                <i class='fa fa-caret-down'></i>
            </div>
            <div class='sec3' part='bill'>
                <span>本周</span>
                <span>本月</span>
                <span>上周</span>
                <span>上月</span>
            </div>
        </div> -->
        <div>
            <img src="__PUBLIC__/img/bill.png" alt="">
            <div class="sec1">
                <span>入职人数</span>
                <span class='range' data-part='enter'>本周</span>
            </div>
            <span class="showNum" part='enter'>{$datasum['enterNum']}</span>
            <div class='sec2'>
                <!-- <span>本年</span>
                <i class='fa fa-caret-down'></i> -->
            </div>
            <div class='sec3' part='enter'>
                <span>本周</span>
                <span>本月</span>
                <span>上周</span>
                <span>上月</span>
            </div>
        </div>
        <div>
            <img src="__PUBLIC__/img/block4.png" alt="">
            <div class="sec1">
                <span>offer人数</span>
                <span class='range' data-part='offer_num'>本周</span>
            </div>
            <span class="showNum" part='offer_num'>{$datasum['offerNum']}</span>
            <div class='sec2'>
                <!-- <span>本年</span>
                <i class='fa fa-caret-down'></i> -->
            </div>
            <div class='sec3' part='offer_num'>
                <span>本周</span>
                <span>本月</span>
                <span>上周</span>
                <span>上月</span>
            </div>
        </div>
        <div>
            <img src="__PUBLIC__/img/block5.png" alt="">
            <div class="sec1">
                <span>客户面试数</span>
                <span class='range' data-part='interview_num'>本周</span>
            </div>
            <span class="showNum" part='interview_num'>{$datasum['interviewNum']}</span>
            <div class='sec2'>
                <!-- <span>本年</span>
                <i class='fa fa-caret-down'></i> -->
            </div>
            <div class='sec3' part='interview_num'>
                <span>本周</span>
                <span>本月</span>
                <span>上周</span>
                <span>上月</span>
            </div>
        </div>
        <div>
            <img src="__PUBLIC__/img/block6.png" alt="">
            <div class="sec1">
                <span>推荐简历数</span>
                <span class='range' data-part='fine_project'>本周</span>
            </div>
            <span class="showNum" part='fine_project'>{$datasum['fineNum']}</span>
            <div class='sec2'>
                <!-- <span>本年</span>
                <i class='fa fa-caret-down'></i> -->
            </div>
            <div class='sec3' part='fine_project'>
                <span>本周</span>
                <span>本月</span>
                <span>上周</span>
                <span>上月</span>
            </div>
        </div>
        <div class='moreBlock'>
            <span>
                更多功能正在开发，敬请期待...
            </span>
        </div>
    </div>
    <div class="pipeline">
        <div class="searchBox">
            <span class='secTitle'>Pipeline</span>
            <div class="dimens">
                <span class="choosed">
                    进展中
                </span>
                <span>
                    签订offer
                </span>
                <span>
                    入职
                </span>
            </div>
        </div>
        <div class="pipeCon">
            <table border borderColor='#ccc' class='ing'>

            </table>
        </div>
    </div>
    <section class="reportBox">
        <div class="workMouments">
            <div class="searchBox">
                <span class='secTitle'>待办事项</span>
                <div class="searchInput">
                    <input class="form-control Wdate" input_type="time"
                        onfocus="WdatePicker({dateFmt:'yyyy-MM-dd',onpicked:onpick})" id="end_time" type="text"
                        value="">
                </div>
            </div>
            <div class="content">
                <table>
                    <thead>
                        <th>事件</th>
                        <th>时间</th>
                        <th>重要程度</th>
                        <th>状态</th>
                        <th>操作</th>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="pager_">
                    <select name="" id="pageSize" style="background:none;padding-right:10px;">
                        <option value="20">20</option>
                        <option value="30">30</option>
                        <option value="40">40</option>
                        <option value="50">50</option>
                        <option value="60">60</option>
                        <option value="70">70</option>
                        <option value="80">80</option>
                        <option value="90">90</option>
                        <option value="100">100</option>
                    </select>
                    <span class="totalPage">
                        共0条&nbsp;第1/0页
                    </span>
                    <div class="pageBox">
                        <span class="last">«</span>
                        <span class="page1 choosed">1</span>
                        <span class="next">»</span>
                    </div>
                    <input type="number" id="goto">&nbsp;&nbsp;页&nbsp;&nbsp;&nbsp;&nbsp;
                </div>
            </div>
        </div>
        <div class="report">
            <div class='shortReport'>
                <span class='secTitle'>简报</span>
            </div>
            <div class="tables">
                <table class="self" border borderColor='#ccc'>
                    <tr>
                        <th colspan="5">个人工作简报</th>
                    </tr>
                    <tr>
                        <td>项目</td>
                        <td>当日</td>
                        <td>本周</td>
                        <td>本月</td>
                        <td>本年</td>
                    </tr>
                    <tr>
                        <td>新增客户</td>
                        <td>{$self_count['self_customer_count'][0]}</td>
                        <td>{$self_count['self_customer_count'][1]}</td>
                        <td>{$self_count['self_customer_count'][2]}</td>
                        <td>{$self_count['self_customer_count'][3]}</td>
                    </tr>
                    <tr>
                        <td>新增联系人</td>
                        <td>{$self_count['self_contacts_count'][0]}</td>
                        <td>{$self_count['self_contacts_count'][1]}</td>
                        <td>{$self_count['self_contacts_count'][2]}</td>
                        <td>{$self_count['self_contacts_count'][3]}</td>
                    </tr>
                    <tr>
                        <td>新增项目</td>
                        <td>{$self_count['self_business_count'][0]}</td>
                        <td>{$self_count['self_business_count'][1]}</td>
                        <td>{$self_count['self_business_count'][2]}</td>
                        <td>{$self_count['self_business_count'][3]}</td>
                    </tr>
                    <tr>
                        <td>新增合同</td>
                        <td>{$self_count['self_contract_count'][0]}</td>
                        <td>{$self_count['self_contract_count'][1]}</td>
                        <td>{$self_count['self_contract_count'][2]}</td>
                        <td>{$self_count['self_contract_count'][3]}</td>
                    </tr>
                </table>
                <table class="department" border borderColor='#ccc'>
                    <tr>
                        <th colspan="5">部门工作简报</th>
                    </tr>
                    <tr>
                        <td>时间</td>
                        <td>新增客户 </td>
                        <td>新增联系人 </td>
                        <td>新增项目</td>
                        <td>新增合同</td>
                    </tr>
                    <tr>
                        <td>当日</td>
                        <td>{$dep_count['dep_customer_count'][0]}</td>
                        <td>{$dep_count['dep_contacts_count'][0]}</td>
                        <td>{$dep_count['dep_business_count'][0]}</td>
                        <td>{$dep_count['dep_contract_count'][0]}</td>
                    </tr>
                </table>
            </div>
        </div>
    </section>
</div>
<link href="__PUBLIC__/css/litebox.css" rel="stylesheet" type="text/css">
<script src="__PUBLIC__/js/litebox.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/images-loaded.min.js" type="text/javascript"></script>

<div id="dialog-message" style="display:none" title="{:L('ADD_A_PANEL_COMPONENT')}">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div id="dialog-message2" style="display:none" title="{:L('MODIFY_THE_PANEL_COMPONENT')}">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div id="dialog-role-info" style="display:none" title="{:L('DIALOG_USER_INFO')}">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>

<include file="Public:mapbaidu" />
<link href="__PUBLIC__/css/litebox.css" rel="stylesheet" type="text/css">
<script src="__PUBLIC__/js/litebox.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/images-loaded.min.js" type="text/javascript"></script>
<!--(Optional) the js for jquery.mCustomScrollbar's addon-->
<script src="__PUBLIC__/emoji/js/jquery.mousewheel-3.0.6.min.js"></script>
<!--the js for jquery.mCustomScrollbar-->
<script src="__PUBLIC__/emoji/js/jquery.mCustomScrollbar.min.js"></script>
<!--the js for this plugin-->
<script src="__PUBLIC__/emoji/js/jquery.emoji.js"></script>
<script type="text/javascript">
    $(document).on('mouseenter', '.file_tr', function () {
        $(this).find(".controls_file").show();
    });
    $(document).on('mouseleave', '.file_tr', function () {
        $(this).find(".controls_file").hide();
    });
    $('#page-wrapper').css('backgroundColor', '#fff').css('min-width', '1190px')
    //获取文件名后缀(是否图片类型)
    function js_getExtension(file) {
        var file = file;
        var filename = file.replace(/.*(\/|\\)/, "");
        var fileExt = (/[.]/.exec(filename)) ? /[^.]+$/.exec(filename.toLowerCase()) : '';
        var img_arr = ["jpg", "jpeg", "gif", "png"];
        if ($.inArray(fileExt, img_arr)) {
            return true;
        } else {
            return false;
        }
    }
    $('.litebox_file').liteBox({
        revealSpeed: 400,
        background: 'rgba(0,0,0,.8)',
        overlayClose: true,
        escKey: true,
        navKey: true,
        errorMessage: '图片加载失败.'
    });

    //排序
    $(".sort-list").sortable({
        stop: function () {
            var chart_arr = new Array();
            $(".sort-item").each(function (key, val) {
                chart_arr.push($(val).attr('rel'));
                console.log($(val).attr('rel'));
            });
            $.post('{:U("index/sortCharts")}', {
                chart_arr: chart_arr.join(',')
            }, 'json');
        }
    });
    //litebox
    $('.litebox').liteBox({
        revealSpeed: 400,
        background: 'rgba(0,0,0,.8)',
        overlayClose: true,
        escKey: true,
        navKey: true,
        errorMessage: '图片加载失败.'
    });

    $('#dialog-collection').dialog({
        autoOpen: false,
        modal: true,
        width: 930,
        maxHeight: 480,
        position: ["center", 100]
    });

    $('#dialog-message').dialog({
        autoOpen: false,
        modal: true,
        width: 600,
        maxHeight: 400,
        position: ["center", 100],
        buttons: {
            "{:L('OK')}": function () {
                $('#widget_add').submit();
                $(this).dialog("close");
            },
            "{:L('CANCEL')}": function () {
                $(this).dialog("close");
            }
        }
    });

    $('#dialog-message2').dialog({
        autoOpen: false,
        modal: true,
        width: 600,
        maxHeight: 400,
        position: ["center", 100],
        buttons: {
            "{:L('OK')}": function () {
                $('#widget_edit').submit();
                $(this).dialog("close");
            },
            "{:L('CANCEL')}": function () {
                $(this).dialog("close");
            }
        }
    });
    $("#dialog-role-info").dialog({
        autoOpen: false,
        modal: true,
        width: 600,
        minHeight: 420,
        position: ["center", 100]
    });

    $(function () {
        $("#add").click(
            function () {
                $('#dialog-message').dialog('open');
                $('#dialog-message').load('{:U("index/widget_add")}');
            }
        );
        $("#collection_target").click(function () {
            $role_id = $(this).attr('rel');
            $('#dialog-collection').dialog('open');
            $('#dialog-collection').load('{:U("index/collection_add","owner_role_id=")}' + $role_id);
        });
        $(".update").click(
            function () {
                id = $(this).attr('rel');
                $('#dialog-message2').dialog('open');
                $('#dialog-message2').load("{:U('index/widget_edit','id=')}" + id);
            }
        );
        $("#list").on("click", ".role_info", function () {
            $role_id = $(this).attr('rel');
            $('#dialog-role-info').dialog('open');
            $('#dialog-role-info').load('{:U("user/dialoginfo","id=")}' + $role_id);
        });

        //包含下属
        $("#include_subordinates").click(function () {
            var subordinates = $(this).is(':checked');
            if (subordinates == true) {
                window.location.href = "{:U('index/index', 'is_checked=')}" + 1;
            } else {
                window.location.href = "{:U('index/index', 'is_checked=')}" + 2;
            }
        });
    });
    $(document).ready(function () {
        $("#list").on("click", ".map", function () {
            $(this).next('.allmap').slideToggle('show');
            var a = $(this).siblings('.longitude').attr('rel');
            var b = $(this).siblings('.latitude').attr('rel');
            var vals = $(this).next('.allmap').attr('rel');
            var url = "{:U('index/gettranslocation')}" + "&longtitude=" + a + "&latitude=" + b;
            $.get(url, function (data) {
                var x = data.data.x;
                var y = data.data.y;
                setTimeout("mapInit(" + y + "," + x + "," + vals + ")", 1000);
            })
        });
    });

    $("#dialog-role-info").dialog({
        autoOpen: false,
        modal: true,
        width: 600,
        maxHeight: 550,
        position: ["center", 100]
    });
    //任务
    /*任务详情 加载的圈圈效果*/
    var detail_html = '<div class="spiner-example">\
                                        <div class="sk-spinner sk-spinner-fading-circle">\
                                                <div class="sk-circle1 sk-circle"></div>\
                                                <div class="sk-circle2 sk-circle"></div>\
                                                <div class="sk-circle3 sk-circle"></div>\
                                                <div class="sk-circle4 sk-circle"></div>\
                                                <div class="sk-circle5 sk-circle"></div>\
                                                <div class="sk-circle6 sk-circle"></div>\
                                                <div class="sk-circle7 sk-circle"></div>\
                                                <div class="sk-circle8 sk-circle"></div>\
                                                <div class="sk-circle9 sk-circle"></div>\
                                                <div class="sk-circle10 sk-circle"></div>\
                                                <div class="sk-circle11 sk-circle"></div>\
                                                <div class="sk-circle12 sk-circle"></div>\
                                        </div>\
                                </div>';
    //鼠标点击空白处，隐藏右侧滑出
    //任务详情弹出
    $(document).on('click', '.task_view', function () {
        var task_id = $(this).attr('rel');
        // var is_show = document.getElementById("is_show").value;
        $(".emoji_container").remove();
        if ($("#right-sidebar-task").css('right') != '0px') {
            $("#right-sidebar-task").animate({
                right: '0px'
            }, 600);
        }

        $('#task-content').html(detail_html);
        $('#sidebar-container').load("{:U('task/view','task_id=')}" + task_id);
    });
</script>
<include file="Public:footer" />

<div id="right-sidebar-task">
    <!--the css for jquery.mCustomScrollbar-->
    <link rel="stylesheet" href="__PUBLIC__/emoji/css/jquery.mCustomScrollbar.min.css" />
    <!--the css for this plugin-->
    <link rel="stylesheet" href="__PUBLIC__/emoji/css/jquery.emoji.css" />
    <!--(Optional) the js for jquery.mCustomScrollbar's addon-->
    <script src="__PUBLIC__/emoji/js/jquery.mousewheel-3.0.6.min.js"></script>
    <!--the js for jquery.mCustomScrollbar-->
    <script src="__PUBLIC__/emoji/js/jquery.mCustomScrollbar.min.js"></script>
    <!--the js for this plugin-->
    <script src="__PUBLIC__/emoji/js/jquery.emoji.js"></script>

    <div class="sidebar-container" id="sidebar-container">

    </div>
</div>