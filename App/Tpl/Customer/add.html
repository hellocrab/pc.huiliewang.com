<include file="Public:header" />
<link rel="stylesheet" href="__PUBLIC__/css/class.public.css" />
<script src="__PUBLIC__/resume_selector/common.21a64352.js"></script>
<link rel="stylesheet" href="__PUBLIC__/resume_selector/common.41f94c00.css">
<link rel="stylesheet" href="__PUBLIC__/resume_selector/resume.search.12eb3a9b.css">

<script type="text/javascript" src="__PUBLIC__/js/PCASClass.js" ></script>
<style type="text/css">
	.add_title{
		padding-bottom:10px;
		height: 60px;
		margin-bottom:15px;
	}
	.add_title>span{
		border-bottom: 2px solid #1ab394;
		font-size: 24px;
	}
	.add_body >div >.full-height-scroll{
		border-right:1px dotted #ccc
	}
	.add_body_title{
		margin:20px auto 20px auto;
		padding-left: 25px;
	}
	.add_body_form{
		padding-left: 38px;
	}
	.add_body_form>form>.form-group{
		margin-bottom: 25px;
	}
	body{overflow-y:hidden;}
	.form-control{
		float:left;
	}
	.checkbox{float:left;}
    .LocalDataUIB,.LocalDataUID-simulation-text{
        width: 100% !important;
    }
</style>
<script>
    $(function(){
        $(".add_body").height(window.innerHeight-$("#add_body").offset().top-$("#tfoot_div").height()-40);
        $(window).resize(function(){
            $(".add_body").height(window.innerHeight-$("#add_body").offset().top-$("#tfoot_div").height()-40);
        })
    })
</script>
<div class="wrapper wrapper-content animated fadeIn">
	<form class="form-horizontal" id="form" role="form" action="{:U('customer/add')}" method="post">
		<input type="hidden" name="refer_url" value="{$refer_url}">
		<div class="ibox-content add_body" id="add_body" style="">
			<div class="row">
				<div class="col-md-6 add_body" style="padding-right: 0px;">
					<div class="full-height-scroll">
						<div class="row" >
							<div class="col-md-12 add_body_title">
								<div class="all-inline">
									<span class="sq-tag"></span>
									<div class="text-tag">
										<span>基础信息</span>
									</div>
								</div>
							</div>
							<div class="col-md-11 add_body_form">
								<volist name="field_list['main']" id="vo" key="key">
									<if condition="$vo['field'] neq 'customer_owner_id'">
										<div class="form-group">
											<label class="col-md-4 control-label" >{$vo.name}：</label>
											<if condition="$vo['form_type'] == 'textarea'">
												<if condition = "$vo['tip_start'] eq 1">
													<div class="col-md-6">
														{$vo.html}
													</div>
															<div class="col-md-2 showeee"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
													<else/>
													<div class="col-md-8">
														{$vo.html}
													</div>
												</if>
												<elseif condition="$vo['form_type'] == 'address'"/>
												<if condition = "$vo['tip_start'] eq 1">
													<div class="col-md-7">
														{$vo.html}
													</div>
													<div class="col-md-1 showeee"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
													<else/>
													<div class="col-md-8">
														{$vo.html}
													</div>
												</if>
												<elseif condition="$vo['form_type'] == 'box'"/>
												<div class="col-md-6">
													<if condition="$vo['field'] == 'grade'">
														<input type="hidden" id="star" name="grade" value="">
														<div class="all-star" style="font-size: 18px;padding-top:3px;color:#D0D0D0;">
															<i class="fa fa-star">&nbsp;&nbsp;</i><i class="fa fa-star">&nbsp;&nbsp;</i><i class="fa fa-star">&nbsp;&nbsp;</i><i class="fa fa-star">&nbsp;&nbsp;</i><i class="fa fa-star">&nbsp;&nbsp;</i>
														</div>
														<else/>
														{$vo.html}
													</if>
												</div>
												<if condition = "$vo['tip_start'] eq 1">
													<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
													<else/>
													<div class="col-md-2"></div>
												</if>
												<elseif condition="$vo['field'] == 'name'"/>
												<div class="col-md-6">
													<input class="form-control required" id="name"onkeyup="checkinfo(name)"  name="name" placeholder="" type="text" maxlength="30"/>
												</div>
												<if condition = "$vo['tip_start'] eq 1">
													<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
													<else/>
													<div class="col-md-2"></div>
												</if>
												<else/>
												<div class="col-md-6">
													{$vo.html}
												</div>
												<if condition = "$vo['tip_start'] eq 1">
													<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
													<else/>
													<div class="col-md-2"></div>
												</if>
											</if>
										</div>
									</if>
								</volist>
								<div class="form-group">
									<label class="col-md-4 control-label">维护人：</label>
									<div class="col-md-6">
										<input type="hidden" name="customer_owner_id" id="user_id" value="{$business.customer_id}" />
										<input class="form-control required" aria-required="true" placeholder="请点击选择"  type="text" name="customer_owner_name" id="user_name" value="{$business.customer_name}" readonly="true" style="cursor:pointer;" title="请点击选择"/>
									</div>
									<div class="col-md-2"><span style="color:red;line-height: 32px;margin-left: 10px;">*</span></div>
								</div>
							</div>
							<div class="col-md-12 add_body_title">
								<div class="all-inline">
									<span class="sq-tag"></span>
									<div class="text-tag">
										<span>附加信息</span>
									</div>
								</div>
							</div>
							<div class="col-md-11 add_body_form">
								<volist name="field_list['data']" id="vo" key="key">
									<div class="form-group">
										<label class="col-md-4 control-label">{$vo.name}：</label>
										<if condition="$vo['form_type'] == 'address' || $vo['form_type'] == 'box' || $vo['form_type'] == 'textarea'">
											<div class="col-md-7">
												{$vo.html}
											</div>
											<if condition = "$vo['tip_start'] eq 1">
												<div class="col-md-1"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
												<else/>
												<div class="col-md-1"></div>
											</if>
											<else/>
											<div class="col-md-6">
												{$vo.html}
											</div>
											<if condition = "$vo['tip_start'] eq 1">
												<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
												<else/>
												<div class="col-md-2"></div>
											</if>
										</if>
									</div>
								</volist>
							</div>
							<div class="col-md-1 pull-right">
								<!-- <div style="height: 100%; border-right: 1px dashed gray;">&nbsp;sadf</div> -->
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-6 add_body" style="padding-left: 0px;">
					<div class="full-height-scroll">
						<div class="col-md-12 add_body_title">
							<div class="all-inline">
								<span class="sq-tag"></span>
								<div class="text-tag">
									<span>客户联系人</span>
								</div>
							</div>
						</div>
						<div class="col-md-10 add_body_form">
							<volist name="contacts_field_list['main']" id="vo" key="key">
								<if condition = "$vo['form_type'] neq 'customer'">
									<div class="form-group">
										<label class="col-md-4 control-label">{$vo.name}：</label>
										<if condition="$vo['form_type'] == 'textarea'">
											<div class="col-md-8">
												<textarea class="form-control" rows="5"></textarea>
											</div>
											<elseif condition="$vo['form_type'] == 'address'"/>
											<div class="col-md-8">
												{$vo.html}
											</div>
											<elseif condition="$vo['form_type'] == 'box'"/>
											<div class="col-md-6">
												{$vo.html}
											</div>
											<div class="col-md-2"></div>
											<else/>
											<div class="col-md-6">
												{$vo.html}
											</div>
											<div class="col-md-2"></div>
										</if>
									</div>
								</if>
							</volist>
						</div>
						<if condition = "$contacts_field_list['data']">
							<div class="col-md-12 add_body_title">
								<div classs="all-inline">
									<span class="sq-tag"></span>
									<div class="text-tag">
										<span>附加信息</span>
									</div>
								</div>
							</div>
						</if>
						<div class="col-md-10 add_body_form">
							<volist name="contacts_field_list['data']" id="vo" key="key">
								<div class="form-group">
									<label class="col-md-4 control-label">{$vo.name}：</label>
									<if condition="$vo['form_type'] == 'address' || $vo['form_type'] == 'box' || $vo['form_type'] == 'textarea'">
										<div class="col-md-8">
											{$vo.html}
										</div>
										<else/>
										<div class="col-md-6">
											{$vo.html}
										</div>
										<div class="col-md-2"></div>
									</if>
								</div>
							</volist>
						</div>
						<div class="col-md-2 pull-right">
							<!-- <div style="height: 100%; border-right: 1px dashed gray;">&nbsp;sadf</div> -->
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="tfoot_div" class="clearfix">
			<div class="clearfix" id="tfoot_page">
				<div class="ibox-content" style="border-top: none;">
					<div class="col-sm-offset-2">
                        <button type="submit" id="save_submit" class="btn btn-primary">保存</button>
                        <input class="btn btn-default" type="button" onclick="javascript:history.go(-1)" value="{:L('RETURN')}"/>
                    </div>
				</div>
			</div>
		</div>
	</form>
</div>

<div style="display:none" id="dialog-role-list2" title="选择维护人">
	<div class="spiner-example">
		<div class="sk-spinner sk-spinner-three-bounce">
			<div class="sk-bounce1"></div>
			<div class="sk-bounce2"></div>
			<div class="sk-bounce3"></div>
		</div>
	</div>
</div>
<div style="display:none" id="dialog-validate" title="{:L('CUSTOMER_NAME_TEST_RESULTS')}">
	{:L('HAVE_THE_FOLLOWING_CUSTOMERS_ARE_SIMILAR_TO_THE_CUSTOMER_NAME')}
	<div id="search_content"></div>
</div>
<script>
	//线下项目 简介和地址必填 ，其它不必填
    function outline_change(obj){
		if(obj.value.search("线下") != -1){
			$(".showeee").css('display','block');
			$("#introduce").attr('class','form-control required');
		}else {
			$(".showeee").css('display', 'none');
			$("#introduce").attr('class','form-control');
		}
	}

	$(document).ready(function () {
		$('#user_name').val('');
    });
    function checkinfo(param){
        var field_value = $('#'+param).val();
        if(field_value){
            $.post('{:U("customer/checkinfo")}',
                {
                    field_value:field_value,
                    field_name:param,
                },
                function(data){
                    if(data.status == 1){
                        $('#'+param+'-error').remove('');
                        $('#'+param).after('<label id="'+param+'-error" class="error" for="source"><i class="fa fa-times-circle"></i></label>');
                        $('#'+param+'-error').html('<i class="fa fa-times-circle"></i>'+data.data);
                    }else{
                        $('#'+param+'-error').remove('');
                    }
                },
                'json');
        }
    }
    $(document).ready(function(){
        $('#save_submit').prop('disabled',false);
        /*form表单验证*/
        $("#form").validate({
            submitHandler:function(form){
                $('#save_submit').click(function(){
                    $('#save_submit').prop('disabled',true);
                });
                form.submit();
            }
        });
    });

    $('#user_name').click(function () {
        $('#dialog-role-list2').dialog('open');
        $('#dialog-role-list2').load("{:U('User/listDialog')}");
    });

    $('#dialog-role-list2').dialog({
        autoOpen: false,
        modal: true,
        width: 700,
        maxHeight: 400,
        buttons: {
            "{:L('CONFIRM')}": function () {
                var joiner = new Array();
                var joiner_name = new Array();
                $('input:checkbox[name="owner"]:checked').each(function () {
                    joiner.push($(this).val());
                    joiner_name.push($(this).attr('rel'));
                })
                joiner = joiner.join(",");
                joiner_name = joiner_name.join(",");
                var nameskey=sessionStorage.getItem("nameskey");
                var idskey=sessionStorage.getItem("idskey");
                $('#user_name').val("");
                $('#user_id').val("");
                $('#user_name').val(nameskey);
                $('#user_id').val(idskey);
                $(this).dialog("close");
            },
            "{:L('CANCEL')}": function () {
                $(this).dialog("close");
            }
        },
        position:["center",100]
    });


    /*星星特效*/
    $('.fa-star').mousemove(function(){
        $(this).addClass("star-orange");
        $(this).prevAll().addClass("star-orange");
        $(this).nextAll().removeClass("star-orange");
    });
    $('.fa-star').mouseout(function(){
        var star = $('#star').val();
        if(star == '' || star == null){
            $('.fa-star').removeClass("star-orange");
        }else{
            $('.fa-star').removeClass("star-orange");
            $('.fa-star:lt('+star+')').addClass("star-orange");
        }
    });
    $('.fa-star').click(function(){
        var num = $(this).index() + 1;
        $('#star').val(num);
    });
    /*地区联动*/
    //new PCAS("province","city","area")//三级联动，有默认值，有文字提示信息
    $("#dialog-validate").dialog({
        autoOpen: false,
        modal: true,
        width: 400,
        maxHeight: 400,
        buttons: {
            "确定": function () {
                $(this).dialog("close");
            }
        },
        position: ["center", 100]
    });
    $('#name').blur(
        function(){
            name = $('#name').val();
            if(name != ''){
                $.post('{:U("customer/check")}',
                    {
                        name:name
                    },
                    function(data){
                        if(data.data != 0){
                            $result = '';
                            $.each(data.data, function(k, v){
                                $result += (k+1)+'、'+v+'</br>';
                            });
                            $('#dialog-validate').dialog('open');
                            $("#search_content").html($result);
                            // alert_crm($result,"","warning");
                        }
                    },
                    'json');
            }
            /*else {
                alert('{:L('PLEASE_FILL_OUT_THE_CUSTOMER_NAME')}');
            }*/
        }
    )

</script>
<script src="__PUBLIC__/resume_selector/resume.search.910ebde0.js "></script>
<include file="Public:footer" />
