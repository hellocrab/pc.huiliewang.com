webpackJsonp([47],{487:function(t,e,i){function s(t){i(782)}var r=i(0)(i(654),i(910),s,"data-v-1afe387f",null);t.exports=r.exports},654:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(15),r=i.n(s),n=i(14),a=i(10),c=i(28),l=i(3),o=i(138),h=i.n(o),m=i(35),p=i.n(m),d=i(146),u=i.n(d),f=i(147),y=i.n(f),_=i(139),g=i.n(_),v=i(137),I=i.n(v),x=i(125),T=i.n(x),C=i(124),$=i.n(C),S=i(20),P=i.n(S),b=i(49),k=i.n(b),L=i(9);e.default={name:"crmsearch",components:{Grid:T.a,GridItem:$.a,Group:P.a,Cell:k.a,CommonCell:h.a,ListCell:p.a,FreceivablesCell:u.a,FreceivingorderCell:y.a,BusinessCell:I.a,ContractCell:g.a},computed:r()({},i.i(L.b)(["crmSearchListInfo"]),{PlateType:function(){return a.a},showProductSelect:function(){return"productmultiple"===this.$route.params.action}}),data:function(){return{p:1,type:"",searchText:"",listItem:[]}},mounted:function(){this.initInfo(),this.$refs.my_scroller.finishInfinite(!0)},beforeDestroy:function(){c.a.$off("searchtextDone")},beforeRouteLeave:function(t,e,i){"default"===this.$route.params.action&&("maindetail"===t.name||"crmdetail"===t.name?this.$store.commit("updateCrmSearchListInfo",{type:this.$route.params.type,list:this.listItem,p:this.p,searchText:this.searchText,scroll:this.$refs.my_scroller.getPosition().top,loadingState:this.$refs.my_scroller.loadingState}):this.$store.commit("updateCrmSearchListInfo",{type:"",list:[],p:1,scroll:0,loadingState:0})),i()},methods:{initInfo:function(){var t=this;c.a.$on("searchtextDone",function(t){this.searchContent(t)}.bind(this)),this.type=this.$route.params.type,this.crmSearchListInfo.type===this.type&&(this.listItem=this.crmSearchListInfo.list,this.p=this.crmSearchListInfo.p,this.searchText=this.crmSearchListInfo.searchText,this.$nextTick(function(){t.$refs.my_scroller.resize(),t.$refs.my_scroller.scrollTo(0,t.crmSearchListInfo.scroll,!1),2===t.crmSearchListInfo.loadingState&&t.$refs.my_scroller.finishInfinite(!0)}))},searchContent:function(t){""!==t&&this.searchText!==t&&(this.p=1,this.searchText=t,this.listItem=[],this.$refs.my_scroller.finishInfinite(!1))},enterDetail:function(t){"default"===this.$route.params.action?this.type===a.a.Product?this.$router.push({name:"crmdetail",params:{id:t.id,type:this.type}}):this.$router.push({name:"maindetail",params:{id:t.id,type:this.type}}):"select"===this.$route.params.action&&(c.a.$emit("selectedRelateItem",{type:this.type,fromtype:this.$route.params.fromtype,item:t,section:this.$route.params.section,row:this.$route.params.row,addition:this.$route.params.addition}),this.type===a.a.Business&&this.$route.params.fromtype===a.a.Contacts&&this.$store.commit("updateCrmDetailInfoRefresh",!0),this.$router.go(-2))},refresh:function(t){this.p=1,this.getList(t)},infinite:function(t){this.getList(t)},getList:function(t){if(""!==this.searchText){var e="",s={};this.type===a.a.Leads?(e="m=leads&a=index",s.field="name"):this.type===a.a.Customer?(e="m=customer&a=index",s.field="name"):this.type===a.a.CustomerPool?(e="m=customer&a=index&content=resource",s.field="name"):this.type===a.a.Business?(e="m=business&a=index",s.field="name"):this.type===a.a.Contract?(e="m=contract&a=index",s.field="number"):this.type===a.a.Contacts?(e="m=contacts&a=index",s.field="name"):this.type===a.a.Product?(e="m=product&a=index",s.field="name"):this.type===a.a.FinanceReceivables?(e="m=finance&a=index",s.t="receivables",s.field="name"):this.type===a.a.FinanceReceivingorder&&(e="m=finance&a=index",s.t="receivingorder",s.field="name"),"select"===this.$route.params.action?(s.p=this.p,s.condition="contains",s.search=this.searchText,this.type===a.a.Contacts?s.customer_id=this.$route.params.addition:this.type===a.a.Business&&(s.customer_id=this.$route.params.addition.customer_id)):this.$route.params.type===a.a.Product?-1!==this.filterMenuIndex&&(s.p=this.p,s.condition="contains",s.search=this.searchText,s.category_id=this.filterSelectID):(s.p=this.p,s.condition="contains",s.search=this.searchText),i.i(n.a)("POST",e,s,this,function(e,s,r){if(r&&i.i(l.h)(e.list)){for(var n=[],a=0;a<e.list.length;a++)n[a]=s.getNewItem(e.list[a]);1===s.p?s.listItem=n:s.listItem=s.listItem.concat(n),"function"==typeof t&&(1===s.p&&e.list.length<10?t(!0):0===e.list.length?t(!0):t()),s.p=s.p+1}})}},getNewItem:function(t){if(this.type===a.a.Leads)return{title:t.name,detail:""===t.mobile?"无":t.mobile,rightTitle:i.i(l.i)(t.create_time),permission:t.permission,id:t.leads_id};if(this.type===a.a.Customer||this.type===a.a.CustomerPool)return{title:t.name,detail:t.owner_name,rightTitle:i.i(l.i)(t.create_time),permission:t.permission,id:t.customer_id};if(this.type===a.a.Business)return{title:t.name,detail:t.customer_name,rightTitle:i.i(l.i)(t.create_time),rightDetail:t.final_price,percent:t.schedule,schedule:t.status_name,permission:t.permission,id:t.business_id};if(this.type===a.a.Contract)return{title:t.number,detail:t.customer_name,rightTitle:i.i(l.i)(t.create_time),rightDetail:t.price,percent:parseInt(t.schedule)>100?"100":t.schedule.toString(),is_checked:t.is_checked,permission:t.permission,id:t.contract_id};if(this.type===a.a.Contacts)return{title:t.name,detail:t.customer_name,rightTitle:t.telephone,permission:t.permission,id:t.contacts_id};if(this.type===a.a.Product){var e=!1;if("productmultiple"===this.$route.params.action)for(var s=0;s<this.selectItemList.length;s++){var r=this.selectItemList[s];r.id===t.product_id&&(e=!0)}return{title:t.name,detail:""===t.standard?t.standard:"价格（元/"+t.standard+"）",rightTitle:t.suggested_price,standard:t.standard,permission:t.permission,id:t.product_id,selected:e}}return this.type===a.a.FinanceReceivables?(t.schedule=parseInt(t.schedule)>100?"100":t.schedule.toString(),t.id=t.receivables_id,t):this.type===a.a.FinanceReceivingorder?(t.id=t.receivingorder_id,t):{top:"",left:"",right:""}}}}},716:function(t,e,i){e=t.exports=i(73)(!0),e.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"CRMSearch.vue",sourceRoot:""}])},782:function(t,e,i){var s=i(716);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);i(476)("47df1268",s,!0)},910:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("scroller",{ref:"my_scroller",attrs:{"on-refresh":t.refresh,"on-infinite":t.infinite}},[t.type==t.PlateType.Leads||t.type==t.PlateType.Customer||t.type==t.PlateType.CustomerPool||t.type==t.PlateType.Contacts?i("div",{staticClass:"weui-cells",staticStyle:{"margin-top":"0px"}},t._l(t.listItem,function(e,s){return i("common-cell",{key:s,attrs:{title:e.title,detail:e.detail,rightTitle:e.rightTitle},nativeOn:{click:function(i){t.enterDetail(e)}}})})):t._e(),t._v(" "),t.type==t.PlateType.Contract?i("div",{staticClass:"weui-cells",staticStyle:{"margin-top":"0px"}},t._l(t.listItem,function(e,s){return i("contract-cell",{key:s,attrs:{title:e.title,detail:e.detail,rightTitle:e.rightTitle,rightDetail:e.rightDetail,percent:e.percent,isChecked:e.is_checked},nativeOn:{click:function(i){t.enterDetail(e)}}})})):t._e(),t._v(" "),t.type==t.PlateType.Business?i("div",{staticClass:"weui-cells",staticStyle:{"margin-top":"0px"}},t._l(t.listItem,function(e,s){return i("business-cell",{key:s,attrs:{title:e.title,detail:e.detail,rightTitle:e.rightTitle,rightDetail:e.rightDetail,percent:e.percent,schedule:e.schedule},nativeOn:{click:function(i){t.enterDetail(e)}}})})):t._e(),t._v(" "),t._l(t.listItem,function(e,s){return t.type===t.PlateType.FinanceReceivables?i("freceivables-cell",{key:s,attrs:{item:e},nativeOn:{click:function(i){t.enterDetail(e)}}}):t._e()}),t._v(" "),t._l(t.listItem,function(e,s){return t.type===t.PlateType.FinanceReceivingorder?i("freceivingorder-cell",{key:s,attrs:{item:e},nativeOn:{click:function(i){t.enterDetail(e)}}}):t._e()}),t._v(" "),t.type==t.PlateType.Product?i("group",{attrs:{gutter:"0"}},t._l(t.listItem,function(e,s){return i("cell",{key:s,nativeOn:{click:function(i){t.enterDetail(e)}}},[t.showProductSelect?i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.getSelectImage(e.selected),expression:"getSelectImage(item.selected)"}],staticStyle:{display:"block",margin:"10px"},attrs:{width:"20",height:"20"},on:{click:function(i){t.selectProduct(e)}},slot:"icon"}):t._e(),t._v(" "),i("p",{slot:"title"},[t._v(t._s(e.title))]),t._v(" "),i("div",{staticStyle:{"text-align":"right"},slot:"value"},[i("p",{staticStyle:{"min-height":"16px","font-size":"12px"}},[t._v(t._s(e.detail))]),t._v(" "),i("p",{staticStyle:{color:"#5CB64F"}},[t._v(t._s(e.rightTitle))])])])})):t._e()],2)],1)},staticRenderFns:[]}}});
//# sourceMappingURL=47.669d5be66c1c8f084892.js.map